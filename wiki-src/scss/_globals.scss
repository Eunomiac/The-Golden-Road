@use "sass:color";
@use "./_colors" as *;
@use "./_typography" as *;
@use "./_mixins" as *;

:root {
  // Fixed dimensions keep the faux paper consistent across resolutions.
  --paper-height: 115vh;
  --paper-width: calc(var(--paper-height) * 8.5 / 11);
  --scrollbar-width: 3px;
}

.block {
  // // font-size: 0;

  > *:not(.sub-block) {
    // font-size: 16px;
    width: 100%;
  }

  .sub-block {
    > *:not(.sub-block) {
      // font-size: 16px;
    }
  }
}
.dotline {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  flex-wrap: nowrap;
  flex-basis: 40%;
  min-width: calc(var(--dotline-size) * 7 + var(--dotline-gap) * 4);
  // min-width: 0; // Allow flex item to shrink (overrides min-width when needed)
  max-width: 100%; // Prevent expansion beyond container
  gap: var(--dotline-gap);
  // font-size: 0;
  // min-width: calc(var(--dotline-size) * 7 + var(--dotline-gap) * 4); // Commented out to allow shrinking
  --dotline-size: 16px;
  --dotline-gap: 0;
  --dotline-dot-full: url("../assets/images/dots/dot-full.webp");
  --dotline-dot-empty: url("../assets/images/dots/dot-empty.webp");
  --dotline-dot-bonus: url("../assets/images/dots/dot-bonus.webp");
  --dotline-dot-broken: url("../assets/images/dots/dot-broken.webp");
  --dotline-dot-ghost: url("../assets/images/dots/dot-ghost.webp");
  --dotline-dot-entangled-scar: url("../assets/images/dots/dot-entangled-scar.webp");
  --dotline-dot-entangled-variation: url("../assets/images/dots/dot-entangled-variation.webp");
  --dotline-dot-deviation-scar: url("../assets/images/dots/dot-deviant-scar.webp");
  --dotline-dot-open-deviation-scar: url("../assets/images/dots/dot-deviant-open-scar.webp");
  --dotline-dot-open-scar: url("../assets/images/dots/dot-open-scar.webp");
  --dotline-dot-deviation-variation: url("../assets/images/dots/dot-deviant-variation.webp");
  --dotline-dot-free: url("../assets/images/dots/dot-free.webp");

  --dotline-dot-general: url("../assets/images/dots/dot-general.webp");
  --dotline-dot-ghost-general: url("../assets/images/dots/dot-general-ghost.webp");
  --dotline-dot-ghost: var(--dotline-dot-ghost-general);
  --dotline-dot-entangled-scar: url("../assets/images/dots/dot-general-ink.webp");
  --dotline-dot-entangled-variation: url("../assets/images/dots/dot-general-red.webp");
  --dotline-dot-deviation-scar: var(--dotline-dot-entangled-scar);
  --dotline-dot-open-deviation-scar: var(--dotline-dot-entangled-scar);
  --dotline-dot-open-scar: var(--dotline-dot-entangled-scar);
  --dotline-dot-deviation-variation: var(--dotline-dot-entangled-variation);
  --dotline-dot-free: url("../assets/images/dots/dot-free.webp");

  &.attribute-dotline,
  &.skill-dotline {
    --dotline-size: 12px;
    --dotline-gap: 0.75px;
  }

  &.scar-value.dotline {
    --dotline-dot-full: var(--dotline-dot-entangled-scar);

    .dot {
      &.deviation-dot {
        background-image: var(--dotline-dot-deviation-scar);
      }
      &.open-dot {
        background-image: var(--dotline-dot-open-scar);
        &.deviation-dot {
          background-image: var(--dotline-dot-open-deviation-scar);
        }
      }
    }
  }

  &.variation-value.dotline {
    --dotline-dot-full: var(--dotline-dot-entangled-variation);

    .dot {
      &.deviation-dot {
        background-image: var(--dotline-dot-deviation-variation);
      }
    }
  }


  .dot {
    display: inline-block;
    flex-basis: var(--dotline-size);
    height: var(--dotline-size);
    width: var(--dotline-size);
    vertical-align: middle;
    box-sizing: border-box;
    flex-shrink: 1;
    flex-grow: 1;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    transform-origin: center center;
    transform: scale(1.1);
    order: 2;

    &.full-dot {
      background-image: var(--dotline-dot-full);
      opacity: var(--opacity, 1);
    }
    &.bonus-dot {
      background-image: var(--dotline-dot-bonus);
    }
    &.broken-dot {
      background-image: var(--dotline-dot-broken);
      opacity: var(--opacity, 1);
    }
    &.empty-dot {
      background-image: var(--dotline-dot-empty);
      // opacity: 0.05;
    }
    &.blank-dot {
      opacity: 0;
    }

    &.ghost-dot {
      // position: relative;
      // transform-origin: center center;
      // transform: scale(4);
      // filter: grayscale(1);
      // background-image: var(--dotline-dot-ghost);
      background-image: var(--dotline-dot-ghost-general);
    }

    &.deviation-dot {
      background-image: var(--dotline-dot-deviation);
    }

    &.free-dot {
      background-image: var(--dotline-dot-free);
      order: 1;
    }

    &:nth-child(5n) {
      margin-right: calc(var(--dotline-size) * 2 + 2.5px);
    }
    &:nth-child(6n) {
      margin-left: calc(-1 * (var(--dotline-size) * 2));
    }
  }
}

.source-citation {
  display: inline-flex;
  gap: 8px;
  // background: rgba(0, 0, 0, 0.5);
  // color: $color-parchment;
  // padding: 0 8px;
  font-size: 13px;

  &::before {
    content: "(";
    margin-right: -8px;
  }

  &::after {
    content: ")";
    margin-left: -8px;
  }

  .source-title {
    font-style: italic;
    &::after {
      content: ",";
    }
  }
}

strong.super-strong {
  background: #141414;
  color: #ff7676;
  padding: 0 8px;
  border-radius: 4px;
}